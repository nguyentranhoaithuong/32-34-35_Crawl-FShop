import os
from sklearn.feature_extraction.text import TfidfVectorizer
import pandas as pd
pd.set_option('display.max_columns', None)

root_dir = 'D:\\Khai pha web\\CK\\TXLCMT'
output_dir = 'D:\\Khai pha web\\CK\\TF_IDF'

# Kiểm tra xem thư mục TF_IDF có tồn tại hay không
if not os.path.exists(output_dir):
    # Nếu không, tạo thư mục
    os.makedirs(output_dir)

# Khởi tạo TfidfVectorizer
vectorizer = TfidfVectorizer()

for product_dir in os.listdir(root_dir):
    product_path = os.path.join(root_dir, product_dir)
    if os.path.isdir(product_path):
        documents = []
        file_names = []
        for file_name in ['Nes.txt', 'neutral.txt', 'Pos.txt']:
            file_path = os.path.join(product_path, file_name)
            if os.path.isfile(file_path):
                with open(file_path, 'r', encoding='utf-8') as file:
                    text = file.read()
                    if text:  # Kiểm tra nếu file không rỗng
                        documents.append(text)
                        file_names.append(file_name)
        if documents:  # Kiểm tra nếu có ít nhất một file không rỗng
            tf_idf_matrix = vectorizer.fit_transform(documents)
            df = pd.DataFrame(tf_idf_matrix.toarray(), columns=vectorizer.get_feature_names_out(), index=file_names)
            print(f'{product_dir}')
            new_name_dir = product_dir.replace('TXL', 'TF_IDF')
            df.to_csv(os.path.join(output_dir, f'{new_name_dir}.csv'), index=True, encoding='utf-8-sig')
